# 占いアプリ開発に関するドキュメント

このドキュメントでは、占いアプリを開発する際の経緯と方針をまとめます。ヒアリング内容や技術選定、アプリケーション機能、今後の開発ステップなどを記録し、プロジェクト全体の背景を理解できるようにします。

## 1. ユーザーの背景と目的

ユーザーはウェブエンジニア/ITベンチャーCTOとして、数秘術やタロット、マヤ暦などの占いロジックをプログラム化し、個人向けのアプリケーションを開発したいと考えています。占いの種類や計算方法を学びながら、アプリの仕様策定や技術選定を進め、最終的にはReactベースのアプリを公開することを目指しています。

## 2. 採用検討した占術

ヒアリングの段階で、プログラム化しやすい占術として以下の種類が挙げられました。

- **数秘術 (Numerology)**: 生年月日や名前を数字に変換してライフパスナンバーなどを算出する。計算ルールが明確で実装が容易。
- **タロット**: カードデッキをシャッフルし、展開法に沿ってカードを引き、その意味を表示する。乱数抽出とカード意味データベースがあれば実装可能。
- **マヤ暦 (ツォルキン暦)**: グレゴリオ暦の日付をマヤ暦（20の太陽の紋章×13の音）に変換し、KIN番号やウェイブスペルを求める。少し特殊な日付計算が必要だが、ルールは明文化されている。
- **西洋占星術**: 生年月日・出生時刻・場所からチャートを計算する。天体位置の高精度計算が必要となり、外部のエフェメリスライブラリを利用するのが一般的。
- **四柱推命**や**姓名判断**などの東洋系占術: 干支や五行などを用いて計算する。ルールをソフトウェア化することは可能だが、範囲が広い。

初期プロトタイプとしては計算ルールが明確でデータが少ない**数秘術**と**タロット**、さらに日付ロジックの面白い**マヤ暦**を中心に実装する方針となりました。

## 3. 技術選定とアーキテクチャ

### フロントエンド

- **Next.js (React)** を採用する。Server Side Rendering (SSR) に対応し、SEOにも強く、App Router によるファイルベースルーティングが便利である。
- **PWA (Progressive Web App)** 対応を行い、ネイティブアプリに近い体験を提供する。オフラインキャッシュやホーム画面への追加などが可能。
- デザインには **Tailwind CSS** を用い、シンプルかつ拡張しやすい UI を実装する。
- 将来的にユーザー数が増加した場合やデバイスの機能をフル活用したい場合は **React Native (Expo)** でネイティブアプリを展開する余地を残す。

### バックエンドとデータベース

- **Supabase (PostgreSQL)** または **Firebase (Firestore)** を利用する。どちらもバックエンド as a Service (BaaS) として、認証やデータベースをシンプルに扱える。
  - SupabaseはSQLデータベースを扱いたい場合に適しており、Row Level Security (RLS) によりユーザーごとのデータ保護が容易。
  - FirebaseはFirestoreのNoSQLデータベースとリッチなリアルタイム機能、アプリからの直接アクセスを提供。Mobile向けに親和性が高い。
- ユーザー認証には**Supabase Auth**や**Firebase Authentication**を用い、メール/パスワードやOAuthによるログインを実装する。

### AI APIとの連携

- 占いの文章生成やタロットの解説文など、人間らしい文章が必要な部分は **OpenAI API** (GPTシリーズ) を利用する。
- 計算自体はフロントエンドまたはサーバサイドで実施し、生成された数値やカード結果に基づいてAIに文章を生成させる。APIキーはサーバ側で保持し、クライアントには公開しない。
- コスト管理のためにキャッシュ機構やAPI使用量のモニタリングを検討する。

### デプロイとホスティング

- **Vercel**: Next.jsとの相性が良く、SSRやAPI Routesをサーバレスでホストできる。
- **Firebase Hosting**: Firebase中心の構成を選択する場合はこちら。Firestoreとの統合が容易。
- インフラ運用を軽減するため、初期段階ではサーバレス構成でスタートし、必要に応じて専用バックエンドに移行する。

### ファイル構成例

次のようなディレクトリ構成で実装を進める予定です。

```
uranai-app/
├── app/                  # Next.js App RouterによるページとAPI
│   ├── page.tsx          # トップページ
│   ├── api/              # バックエンドAPI
│   │   └── generate/     # AI連携などのAPIエンドポイント
│   └── ...
├── components/           # 再利用可能なReactコンポーネント
├── lib/                  # ユーティリティ (Supabase/Firebase初期化など)
├── public/               # 画像やPWAマニフェスト
├── styles/               # Tailwindやグローバルスタイル
├── supabase/             # Supabase設定ファイルやSQLスクリプト
├── README.md             # プロジェクト概要
└── ...
```

## 4. アプリの主要機能

以下の機能を段階的に実装していきます。

1. **数秘術診断** – 生年月日や名前からライフパスナンバー等を計算し、結果と解説を表示する。
2. **タロット占い** – カードデッキをシャッフルし、1枚または複数枚引きで展開、カードの意味や総合アドバイスを表示する。
3. **マヤ暦占い** – ユーザーの誕生日からKIN番号や紋章・音を計算し、対応する解説を表示する。
4. **履歴・日記機能** – 占い結果を保存し、ユーザーがメモや感想を残せる日記機能を提供する。ユーザーごとに保存し、他人からは見えないようにする。
5. **ユーザー認証** – ログイン/サインアップ機能の実装、セッション管理。OAuth連携など。
6. **管理コンソール** – 今後の拡張として、管理者が占い項目や文章を更新できるバックオフィスの実装も検討する。

## 5. 今後の開発ステップ

1. GitHubに新規リポジトリを作成し、本ドキュメントを含む初期コミットを行う。
2. Next.jsプロジェクトをセットアップし、数秘術機能のプロトタイプを実装する。
3. SupabaseまたはFirebaseの環境を構築し、ユーザー認証とデータ保存の仕組みを整える。
4. タロット占い機能、マヤ暦占い機能を順次追加する。APIキーの扱いと料金管理を行う。
5. PWA対応やUIデザインを整え、ユーザーテストを実施しながら改良する。
6. 必要に応じてReact Native版の開発や、課金機能の検討などを進める。

---

このドキュメントはプロジェクトの初期段階の指針と記録として保存します。今後の変更や進展は追記していきます。
